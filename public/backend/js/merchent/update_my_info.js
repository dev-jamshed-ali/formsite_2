var cities_by_state = {
    "New York": [
        "New York",
        "Buffalo",
        "Rochester",
        "Yonkers",
        "Syracuse",
        "Albany",
        "New Rochelle",
        "Mount Vernon",
        "Schenectady",
        "Utica",
        "White Plains",
        "Hempstead",
        "Troy",
        "Niagara Falls",
        "Binghamton",
        "Freeport",
        "Valley Stream",
    ],
    California: [
        "Los Angeles",
        "San Diego",
        "San Jose",
        "San Francisco",
        "Fresno",
        "Sacramento",
        "Long Beach",
        "Oakland",
        "Bakersfield",
        "Anaheim",
        "Santa Ana",
        "Riverside",
        "Stockton",
        "Chula Vista",
        "Irvine",
        "Fremont",
        "San Bernardino",
        "Modesto",
        "Fontana",
        "Oxnard",
        "Moreno Valley",
        "Huntington Beach",
        "Glendale",
        "Santa Clarita",
        "Garden Grove",
        "Oceanside",
        "Rancho Cucamonga",
        "Santa Rosa",
        "Ontario",
        "Lancaster",
        "Elk Grove",
        "Corona",
        "Palmdale",
        "Salinas",
        "Pomona",
        "Hayward",
        "Escondido",
        "Torrance",
        "Sunnyvale",
        "Orange",
        "Fullerton",
        "Pasadena",
        "Thousand Oaks",
        "Visalia",
        "Simi Valley",
        "Concord",
        "Roseville",
        "Victorville",
        "Santa Clara",
        "Vallejo",
        "Berkeley",
        "El Monte",
        "Downey",
        "Costa Mesa",
        "Inglewood",
        "Carlsbad",
        "San Buenaventura (Ventura)",
        "Fairfield",
        "West Covina",
        "Murrieta",
        "Richmond",
        "Norwalk",
        "Antioch",
        "Temecula",
        "Burbank",
        "Daly City",
        "Rialto",
        "Santa Maria",
        "El Cajon",
        "San Mateo",
        "Clovis",
        "Compton",
        "Jurupa Valley",
        "Vista",
        "South Gate",
        "Mission Viejo",
        "Vacaville",
        "Carson",
        "Hesperia",
        "Santa Monica",
        "Westminster",
        "Redding",
        "Santa Barbara",
        "Chico",
        "Newport Beach",
        "San Leandro",
        "San Marcos",
        "Whittier",
        "Hawthorne",
        "Citrus Heights",
        "Tracy",
        "Alhambra",
        "Livermore",
        "Buena Park",
        "Menifee",
        "Hemet",
        "Lakewood",
        "Merced",
        "Chino",
        "Indio",
        "Redwood City",
        "Lake Forest",
        "Napa",
        "Tustin",
        "Bellflower",
        "Mountain View",
        "Chino Hills",
        "Baldwin Park",
        "Alameda",
        "Upland",
        "San Ramon",
        "Folsom",
        "Pleasanton",
        "Union City",
        "Perris",
        "Manteca",
        "Lynwood",
        "Apple Valley",
        "Redlands",
        "Turlock",
        "Milpitas",
        "Redondo Beach",
        "Rancho Cordova",
        "Yorba Linda",
        "Palo Alto",
        "Davis",
        "Camarillo",
        "Walnut Creek",
        "Pittsburg",
        "South San Francisco",
        "Yuba City",
        "San Clemente",
        "Laguna Niguel",
        "Pico Rivera",
        "Montebello",
        "Lodi",
        "Madera",
        "Santa Cruz",
        "La Habra",
        "Encinitas",
        "Monterey Park",
        "Tulare",
        "Cupertino",
        "Gardena",
        "National City",
        "Rocklin",
        "Petaluma",
        "Huntington Park",
        "San Rafael",
        "La Mesa",
        "Arcadia",
        "Fountain Valley",
        "Diamond Bar",
        "Woodland",
        "Santee",
        "Lake Elsinore",
        "Porterville",
        "Paramount",
        "Eastvale",
        "Rosemead",
        "Hanford",
        "Highland",
        "Brentwood",
        "Novato",
        "Colton",
        "Cathedral City",
        "Delano",
        "Yucaipa",
        "Watsonville",
        "Placentia",
        "Glendora",
        "Gilroy",
        "Palm Desert",
        "Cerritos",
        "West Sacramento",
        "Aliso Viejo",
        "Poway",
        "La Mirada",
        "Rancho Santa Margarita",
        "Cypress",
        "Dublin",
        "Covina",
        "Azusa",
        "Palm Springs",
        "San Luis Obispo",
        "Ceres",
        "San Jacinto",
        "Lincoln",
        "Newark",
        "Lompoc",
        "El Centro",
        "Danville",
        "Bell Gardens",
        "Coachella",
        "Rancho Palos Verdes",
        "San Bruno",
        "Rohnert Park",
        "Brea",
        "La Puente",
        "Campbell",
        "San Gabriel",
        "Beaumont",
        "Morgan Hill",
        "Culver City",
        "Calexico",
        "Stanton",
        "La Quinta",
        "Pacifica",
        "Montclair",
        "Oakley",
        "Monrovia",
        "Los Banos",
        "Martinez",
    ],
    Illinois: [
        "Chicago",
        "Aurora",
        "Rockford",
        "Joliet",
        "Naperville",
        "Springfield",
        "Peoria",
        "Elgin",
        "Waukegan",
        "Cicero",
        "Champaign",
        "Bloomington",
        "Arlington Heights",
        "Evanston",
        "Decatur",
        "Schaumburg",
        "Bolingbrook",
        "Palatine",
        "Skokie",
        "Des Plaines",
        "Orland Park",
        "Tinley Park",
        "Oak Lawn",
        "Berwyn",
        "Mount Prospect",
        "Normal",
        "Wheaton",
        "Hoffman Estates",
        "Oak Park",
        "Downers Grove",
        "Elmhurst",
        "Glenview",
        "DeKalb",
        "Lombard",
        "Belleville",
        "Moline",
        "Buffalo Grove",
        "Bartlett",
        "Urbana",
        "Quincy",
        "Crystal Lake",
        "Plainfield",
        "Streamwood",
        "Carol Stream",
        "Romeoville",
        "Rock Island",
        "Hanover Park",
        "Carpentersville",
        "Wheeling",
        "Park Ridge",
        "Addison",
        "Calumet City",
    ],
    Texas: [
        "Houston",
        "San Antonio",
        "Dallas",
        "Austin",
        "Fort Worth",
        "El Paso",
        "Arlington",
        "Corpus Christi",
        "Plano",
        "Laredo",
        "Lubbock",
        "Garland",
        "Irving",
        "Amarillo",
        "Grand Prairie",
        "Brownsville",
        "Pasadena",
        "McKinney",
        "Mesquite",
        "McAllen",
        "Killeen",
        "Frisco",
        "Waco",
        "Carrollton",
        "Denton",
        "Midland",
        "Abilene",
        "Beaumont",
        "Round Rock",
        "Odessa",
        "Wichita Falls",
        "Richardson",
        "Lewisville",
        "Tyler",
        "College Station",
        "Pearland",
        "San Angelo",
        "Allen",
        "League City",
        "Sugar Land",
        "Longview",
        "Edinburg",
        "Mission",
        "Bryan",
        "Baytown",
        "Pharr",
        "Temple",
        "Missouri City",
        "Flower Mound",
        "Harlingen",
        "North Richland Hills",
        "Victoria",
        "Conroe",
        "New Braunfels",
        "Mansfield",
        "Cedar Park",
        "Rowlett",
        "Port Arthur",
        "Euless",
        "Georgetown",
        "Pflugerville",
        "DeSoto",
        "San Marcos",
        "Grapevine",
        "Bedford",
        "Galveston",
        "Cedar Hill",
        "Texas City",
        "Wylie",
        "Haltom City",
        "Keller",
        "Coppell",
        "Rockwall",
        "Huntsville",
        "Duncanville",
        "Sherman",
        "The Colony",
        "Burleson",
        "Hurst",
        "Lancaster",
        "Texarkana",
        "Friendswood",
        "Weslaco",
    ],
    Pennsylvania: [
        "Philadelphia",
        "Pittsburgh",
        "Allentown",
        "Erie",
        "Reading",
        "Scranton",
        "Bethlehem",
        "Lancaster",
        "Harrisburg",
        "Altoona",
        "York",
        "State College",
        "Wilkes-Barre",
    ],
    Arizona: [
        "Phoenix",
        "Tucson",
        "Mesa",
        "Chandler",
        "Glendale",
        "Scottsdale",
        "Gilbert",
        "Tempe",
        "Peoria",
        "Surprise",
        "Yuma",
        "Avondale",
        "Goodyear",
        "Flagstaff",
        "Buckeye",
        "Lake Havasu City",
        "Casa Grande",
        "Sierra Vista",
        "Maricopa",
        "Oro Valley",
        "Prescott",
        "Bullhead City",
        "Prescott Valley",
        "Marana",
        "Apache Junction",
    ],
    Florida: [
        "Jacksonville",
        "Miami",
        "Tampa",
        "Orlando",
        "St. Petersburg",
        "Hialeah",
        "Tallahassee",
        "Fort Lauderdale",
        "Port St. Lucie",
        "Cape Coral",
        "Pembroke Pines",
        "Hollywood",
        "Miramar",
        "Gainesville",
        "Coral Springs",
        "Miami Gardens",
        "Clearwater",
        "Palm Bay",
        "Pompano Beach",
        "West Palm Beach",
        "Lakeland",
        "Davie",
        "Miami Beach",
        "Sunrise",
        "Plantation",
        "Boca Raton",
        "Deltona",
        "Largo",
        "Deerfield Beach",
        "Palm Coast",
        "Melbourne",
        "Boynton Beach",
        "Lauderhill",
        "Weston",
        "Fort Myers",
        "Kissimmee",
        "Homestead",
        "Tamarac",
        "Delray Beach",
        "Daytona Beach",
        "North Miami",
        "Wellington",
        "North Port",
        "Jupiter",
        "Ocala",
        "Port Orange",
        "Margate",
        "Coconut Creek",
        "Sanford",
        "Sarasota",
        "Pensacola",
        "Bradenton",
        "Palm Beach Gardens",
        "Pinellas Park",
        "Coral Gables",
        "Doral",
        "Bonita Springs",
        "Apopka",
        "Titusville",
        "North Miami Beach",
        "Oakland Park",
        "Fort Pierce",
        "North Lauderdale",
        "Cutler Bay",
        "Altamonte Springs",
        "St. Cloud",
        "Greenacres",
        "Ormond Beach",
        "Ocoee",
        "Hallandale Beach",
        "Winter Garden",
        "Aventura",
    ],
    Indiana: [
        "Indianapolis",
        "Fort Wayne",
        "Evansville",
        "South Bend",
        "Carmel",
        "Bloomington",
        "Fishers",
        "Hammond",
        "Gary",
        "Muncie",
        "Lafayette",
        "Terre Haute",
        "Kokomo",
        "Anderson",
        "Noblesville",
        "Greenwood",
        "Elkhart",
        "Mishawaka",
        "Lawrence",
        "Jeffersonville",
        "Columbus",
        "Portage",
    ],
    Ohio: [
        "Columbus",
        "Cleveland",
        "Cincinnati",
        "Toledo",
        "Akron",
        "Dayton",
        "Parma",
        "Canton",
        "Youngstown",
        "Lorain",
        "Hamilton",
        "Springfield",
        "Kettering",
        "Elyria",
        "Lakewood",
        "Cuyahoga Falls",
        "Middletown",
        "Euclid",
        "Newark",
        "Mansfield",
        "Mentor",
        "Beavercreek",
        "Cleveland Heights",
        "Strongsville",
        "Dublin",
        "Fairfield",
        "Findlay",
        "Warren",
        "Lancaster",
        "Lima",
        "Huber Heights",
        "Westerville",
        "Marion",
        "Grove City",
    ],
    "North Carolina": [
        "Charlotte",
        "Raleigh",
        "Greensboro",
        "Durham",
        "Winston-Salem",
        "Fayetteville",
        "Cary",
        "Wilmington",
        "High Point",
        "Greenville",
        "Asheville",
        "Concord",
        "Gastonia",
        "Jacksonville",
        "Chapel Hill",
        "Rocky Mount",
        "Burlington",
        "Wilson",
        "Huntersville",
        "Kannapolis",
        "Apex",
        "Hickory",
        "Goldsboro",
    ],
    Michigan: [
        "Detroit",
        "Grand Rapids",
        "Warren",
        "Sterling Heights",
        "Ann Arbor",
        "Lansing",
        "Flint",
        "Dearborn",
        "Livonia",
        "Westland",
        "Troy",
        "Farmington Hills",
        "Kalamazoo",
        "Wyoming",
        "Southfield",
        "Rochester Hills",
        "Taylor",
        "Pontiac",
        "St. Clair Shores",
        "Royal Oak",
        "Novi",
        "Dearborn Heights",
        "Battle Creek",
        "Saginaw",
        "Kentwood",
        "East Lansing",
        "Roseville",
        "Portage",
        "Midland",
        "Lincoln Park",
        "Muskegon",
    ],
    Tennessee: [
        "Memphis",
        "Nashville-Davidson",
        "Knoxville",
        "Chattanooga",
        "Clarksville",
        "Murfreesboro",
        "Jackson",
        "Franklin",
        "Johnson City",
        "Bartlett",
        "Hendersonville",
        "Kingsport",
        "Collierville",
        "Cleveland",
        "Smyrna",
        "Germantown",
        "Brentwood",
    ],
    Massachusetts: [
        "Boston",
        "Worcester",
        "Springfield",
        "Lowell",
        "Cambridge",
        "New Bedford",
        "Brockton",
        "Quincy",
        "Lynn",
        "Fall River",
        "Newton",
        "Lawrence",
        "Somerville",
        "Waltham",
        "Haverhill",
        "Malden",
        "Medford",
        "Taunton",
        "Chicopee",
        "Weymouth Town",
        "Revere",
        "Peabody",
        "Methuen",
        "Barnstable Town",
        "Pittsfield",
        "Attleboro",
        "Everett",
        "Salem",
        "Westfield",
        "Leominster",
        "Fitchburg",
        "Beverly",
        "Holyoke",
        "Marlborough",
        "Woburn",
        "Chelsea",
    ],
    Washington: [
        "Seattle",
        "Spokane",
        "Tacoma",
        "Vancouver",
        "Bellevue",
        "Kent",
        "Everett",
        "Renton",
        "Yakima",
        "Federal Way",
        "Spokane Valley",
        "Bellingham",
        "Kennewick",
        "Auburn",
        "Pasco",
        "Marysville",
        "Lakewood",
        "Redmond",
        "Shoreline",
        "Richland",
        "Kirkland",
        "Burien",
        "Sammamish",
        "Olympia",
        "Lacey",
        "Edmonds",
        "Bremerton",
        "Puyallup",
    ],
    Colorado: [
        "Denver",
        "Colorado Springs",
        "Aurora",
        "Fort Collins",
        "Lakewood",
        "Thornton",
        "Arvada",
        "Westminster",
        "Pueblo",
        "Centennial",
        "Boulder",
        "Greeley",
        "Longmont",
        "Loveland",
        "Grand Junction",
        "Broomfield",
        "Castle Rock",
        "Commerce City",
        "Parker",
        "Littleton",
        "Northglenn",
    ],
    "District of Columbia": ["Washington"],
    Maryland: [
        "Baltimore",
        "Frederick",
        "Rockville",
        "Gaithersburg",
        "Bowie",
        "Hagerstown",
        "Annapolis",
    ],
    Kentucky: [
        "Louisville/Jefferson County",
        "Lexington-Fayette",
        "Bowling Green",
        "Owensboro",
        "Covington",
    ],
    Oregon: [
        "Portland",
        "Eugene",
        "Salem",
        "Gresham",
        "Hillsboro",
        "Beaverton",
        "Bend",
        "Medford",
        "Springfield",
        "Corvallis",
        "Albany",
        "Tigard",
        "Lake Oswego",
        "Keizer",
    ],
    Oklahoma: [
        "Oklahoma City",
        "Tulsa",
        "Norman",
        "Broken Arrow",
        "Lawton",
        "Edmond",
        "Moore",
        "Midwest City",
        "Enid",
        "Stillwater",
        "Muskogee",
    ],
    Wisconsin: [
        "Milwaukee",
        "Madison",
        "Green Bay",
        "Kenosha",
        "Racine",
        "Appleton",
        "Waukesha",
        "Eau Claire",
        "Oshkosh",
        "Janesville",
        "West Allis",
        "La Crosse",
        "Sheboygan",
        "Wauwatosa",
        "Fond du Lac",
        "New Berlin",
        "Wausau",
        "Brookfield",
        "Greenfield",
        "Beloit",
    ],
    Nevada: [
        "Las Vegas",
        "Henderson",
        "Reno",
        "North Las Vegas",
        "Sparks",
        "Carson City",
    ],
    "New Mexico": [
        "Albuquerque",
        "Las Cruces",
        "Rio Rancho",
        "Santa Fe",
        "Roswell",
        "Farmington",
        "Clovis",
    ],
    Missouri: [
        "Kansas City",
        "St. Louis",
        "Springfield",
        "Independence",
        "Columbia",
        "Lee's Summit",
        "O'Fallon",
        "St. Joseph",
        "St. Charles",
        "St. Peters",
        "Blue Springs",
        "Florissant",
        "Joplin",
        "Chesterfield",
        "Jefferson City",
        "Cape Girardeau",
    ],
    Virginia: [
        "Virginia Beach",
        "Norfolk",
        "Chesapeake",
        "Richmond",
        "Newport News",
        "Alexandria",
        "Hampton",
        "Roanoke",
        "Portsmouth",
        "Suffolk",
        "Lynchburg",
        "Harrisonburg",
        "Leesburg",
        "Charlottesville",
        "Danville",
        "Blacksburg",
        "Manassas",
    ],
    Georgia: [
        "Atlanta",
        "Columbus",
        "Augusta-Richmond County",
        "Savannah",
        "Athens-Clarke County",
        "Sandy Springs",
        "Roswell",
        "Macon",
        "Johns Creek",
        "Albany",
        "Warner Robins",
        "Alpharetta",
        "Marietta",
        "Valdosta",
        "Smyrna",
        "Dunwoody",
    ],
    Nebraska: ["Omaha", "Lincoln", "Bellevue", "Grand Island"],
    Minnesota: [
        "Minneapolis",
        "St. Paul",
        "Rochester",
        "Duluth",
        "Bloomington",
        "Brooklyn Park",
        "Plymouth",
        "St. Cloud",
        "Eagan",
        "Woodbury",
        "Maple Grove",
        "Eden Prairie",
        "Coon Rapids",
        "Burnsville",
        "Blaine",
        "Lakeville",
        "Minnetonka",
        "Apple Valley",
        "Edina",
        "St. Louis Park",
        "Mankato",
        "Maplewood",
        "Moorhead",
        "Shakopee",
    ],
    Kansas: [
        "Wichita",
        "Overland Park",
        "Kansas City",
        "Olathe",
        "Topeka",
        "Lawrence",
        "Shawnee",
        "Manhattan",
        "Lenexa",
        "Salina",
        "Hutchinson",
    ],
    Louisiana: [
        "New Orleans",
        "Baton Rouge",
        "Shreveport",
        "Lafayette",
        "Lake Charles",
        "Kenner",
        "Bossier City",
        "Monroe",
        "Alexandria",
    ],
    Hawaii: ["Honolulu"],
    Alaska: ["Anchorage"],
    "New Jersey": [
        "Newark",
        "Jersey City",
        "Paterson",
        "Elizabeth",
        "Clifton",
        "Trenton",
        "Camden",
        "Passaic",
        "Union City",
        "Bayonne",
        "East Orange",
        "Vineland",
        "New Brunswick",
        "Hoboken",
        "Perth Amboy",
        "West New York",
        "Plainfield",
        "Hackensack",
        "Sayreville",
        "Kearny",
        "Linden",
        "Atlantic City",
    ],
    Idaho: [
        "Boise City",
        "Nampa",
        "Meridian",
        "Idaho Falls",
        "Pocatello",
        "Caldwell",
        "Coeur d'Alene",
        "Twin Falls",
    ],
    Alabama: [
        "Birmingham",
        "Montgomery",
        "Mobile",
        "Huntsville",
        "Tuscaloosa",
        "Hoover",
        "Dothan",
        "Auburn",
        "Decatur",
        "Madison",
        "Florence",
        "Gadsden",
    ],
    Iowa: [
        "Des Moines",
        "Cedar Rapids",
        "Davenport",
        "Sioux City",
        "Iowa City",
        "Waterloo",
        "Council Bluffs",
        "Ames",
        "West Des Moines",
        "Dubuque",
        "Ankeny",
        "Urbandale",
        "Cedar Falls",
    ],
    Arkansas: [
        "Little Rock",
        "Fort Smith",
        "Fayetteville",
        "Springdale",
        "Jonesboro",
        "North Little Rock",
        "Conway",
        "Rogers",
        "Pine Bluff",
        "Bentonville",
    ],
    Utah: [
        "Salt Lake City",
        "West Valley City",
        "Provo",
        "West Jordan",
        "Orem",
        "Sandy",
        "Ogden",
        "St. George",
        "Layton",
        "Taylorsville",
        "South Jordan",
        "Lehi",
        "Logan",
        "Murray",
        "Draper",
        "Bountiful",
        "Riverton",
        "Roy",
    ],
    "Rhode Island": [
        "Providence",
        "Warwick",
        "Cranston",
        "Pawtucket",
        "East Providence",
        "Woonsocket",
    ],
    Mississippi: [
        "Jackson",
        "Gulfport",
        "Southaven",
        "Hattiesburg",
        "Biloxi",
        "Meridian",
    ],
    "South Dakota": ["Sioux Falls", "Rapid City"],
    Connecticut: [
        "Bridgeport",
        "New Haven",
        "Stamford",
        "Hartford",
        "Waterbury",
        "Norwalk",
        "Danbury",
        "New Britain",
        "Meriden",
        "Bristol",
        "West Haven",
        "Milford",
        "Middletown",
        "Norwich",
        "Shelton",
    ],
    "South Carolina": [
        "Columbia",
        "Charleston",
        "North Charleston",
        "Mount Pleasant",
        "Rock Hill",
        "Greenville",
        "Summerville",
        "Sumter",
        "Goose Creek",
        "Hilton Head Island",
        "Florence",
        "Spartanburg",
    ],
    "New Hampshire": ["Manchester", "Nashua", "Concord"],
    "North Dakota": ["Fargo", "Bismarck", "Grand Forks", "Minot"],
    Montana: ["Billings", "Missoula", "Great Falls", "Bozeman"],
    Delaware: ["Wilmington", "Dover"],
    Maine: ["Portland"],
    Wyoming: ["Cheyenne", "Casper"],
    "West Virginia": ["Charleston", "Huntington"],
    Vermont: ["Burlington"],
};

$("#state_physical").change(function () {
    var state = $(this).val();
    var cities = cities_by_state[state];

    // Clear the city select and add the default option
    $("#city_physical")
        .empty()
        .append('<option value="">Select a city</option>');

    // Populate the city select with options based on the selected state
    // $("#city").append("<option selected></option>");
    $.each(cities, function (index, city) {
        $("#city_physical").append(
            `<option value="${city}">` + city + "</option>"
        );
    });
});

$("#ownership_state").change(function () {
    var state = $(this).val();
    var cities = cities_by_state[state];

    // Clear the city select and add the default option
    $("#ownership_city")
        .empty()
        .append('<option value="">Select a city</option>');

    // Populate the city select with options based on the selected state
    // $("#city").append("<option selected></option>");
    $.each(cities, function (index, city) {
        $("#ownership_city").append(
            `<option value="${city}">` + city + "</option>"
        );
    });
});

$("#bank_account_manager_state").change(function () {
    var state = $(this).val();
    var cities = cities_by_state[state];

    // Clear the city select and add the default option
    $("#bank_account_manager_city")
        .empty()
        .append('<option value="">Select a city</option>');

    // Populate the city select with options based on the selected state
    // $("#city").append("<option selected></option>");
    $.each(cities, function (index, city) {
        $("#bank_account_manager_city").append(
            `<option value="${city}">` + city + "</option>"
        );
    });
});

$("#state_legal").change(function () {
    var state = $(this).val();
    var cities = cities_by_state[state];

    // Clear the city select and add the default option
    $("#city_legal").empty().append('<option value="">Select a city</option>');

    // Populate the city select with options based on the selected state
    // $("#city").append("<option selected></option>");
    $.each(cities, function (index, city) {
        $("#city_legal").append(
            `<option value="${city}">` + city + "</option>"
        );
    });
});

$.validator.addMethod(
    "zipcode",
    function (value) {
        return /^\d{5}$/.test(value);
    },
    "Zipcode is not valid"
);
$.validator.addMethod(
    "alphabet_only",
    function (value) {
        return /^[a-zA-Z]+$/.test(value);
    },
    "Use only Char"
);
$.validator.addMethod("alphanumericSpecial", function(value, element) {
    return this.optional(element) || /^[a-zA-Z0-9\s\.,\-_'"]*$/.test(value);
  }, "Please enter a valid input.");

// Add SQL keyword validation method
$.validator.addMethod(
    "no_sql_keywords_and_special_chars",
    function (value, element) {
        if (!value) return true; // Allow empty values

        const forbiddenKeywords = [
            "SELECT", "INSERT", "UPDATE", "DELETE", "DROP", "UNION", "JOIN", 
            "WHERE", "FROM", "ALTER", "CREATE", "TABLE", "DATABASE", "TRUNCATE", 
            "EXEC", "HAVING", "GROUP BY", "ORDER BY", "MERGE", "GRANT", "REVOKE",
            "PROCEDURE", "FUNCTION", "TRIGGER", "INDEX", "VIEW", "SCHEMA", "INTO",
            "VALUES", "SET", "PUT", "DECLARE", "EXECUTE", "SP_", "XP_", ";",
            "WAITFOR", "DELAY", "SHUTDOWN", "BACKUP", "RESTORE", "PRINT", 
             "NULL", "INTRO", "COUNT", "SUM", "AVG", "LIKE", "WILDCARD",
            "/*", "*/", "WAITFOR", "DELAY", "SHUTDOWN", "BACKUP", "RESTORE", "PRINT", "/*", "*/"

        ];

        // Check if any SQL keywords are present (case-insensitive)
        const upperValue = value.toUpperCase();
        for (let keyword of forbiddenKeywords) {
            if (upperValue.includes(keyword)) {
                return false;
            }
        }

        // Check for special characters
        const specialChars = /[!@#$%^&*()_+={}:"<>]/;
        if (specialChars.test(value)) {
            return false;
        }

        return true;
    },
    "SQL keywords and special characters are not allowed in this field"
);

$("#update_my_info_form").validate({
    errorPlacement: function (error, element) {
        error.appendTo(element.siblings("p"));
    },
    onkeyup: function (element) {
        $(element).valid(); // Validate on every keyup
    },
    rules: {
        business_legal_name: {
            required: true,
            maxlength: 20,
            no_sql_keywords_and_special_chars: true
        },
        business_dba_name: {
            maxlength: 20,
            no_sql_keywords_and_special_chars: true
        },
        business_legal_address: {
            required: true,
            maxlength: 40,
            no_sql_keywords_and_special_chars: true
        },
        state_legal: {
            required: true,
            maxlength: 20,
        },
        city_legal: {
            required: true,
            maxlength: 20,
        },
        zip_legal: {
            required: true,
            zipcode: true,
        },
        business_physical_address: {
            maxlength: 40,
            no_sql_keywords_and_special_chars: true
        },
        zip_physical: {
            zipcode: true,
        },
        state_physical: {
            maxlength: 20,
        },
        city_physical: {
            maxlength: 20,
        },
        first_name: {
            maxlength: 20,
            no_sql_keywords_and_special_chars: true
        },
        mi: {
            maxlength: 1,
        },
        last_name: {
            maxlength: 20,
            no_sql_keywords_and_special_chars: true
        },
        telephone_number: {
            // maxlength: 11,
            // no_sql_keywords_and_special_chars: true

        },
        toll_free_number: {
            // maxlength: 10,
            // no_sql_keywords_and_special_chars: true 
        },
        fax_number: {
            // maxlength: 10,
            // no_sql_keywords_and_special_chars: true
        },
        mobile_phone: {
            // maxlength: 13,
            // no_sql_keywords_and_special_chars: true

        },
        email_address: {
            email: true,
            maxlength: 30,
            noemail:true,
        },
        federal_tax_id: {
            maxlength: 9,
            no_sql_keywords_and_special_chars: true
        },
        owner_partner:{
            maxlength:20,
            no_sql_keywords_and_special_chars: true
        },
        ownership_first_name:{
            maxlength:20,
            no_sql_keywords_and_special_chars: true
        },
        ownership_mi:{
            maxlength:1,
        },
        ownership_last_name:{
            maxlength:20,
            no_sql_keywords_and_special_chars: true
        },
        ownership_ssn:{
            // maxlength:9,
        },
        ownership_title:{
            maxlength:20,
            no_sql_keywords_and_special_chars: true
        },
        ownership_telephone:{
            // maxlength: 11,
            // no_sql_keywords_and_special_chars: true
        },
        ownership_percentage:{
            maxlength:3,
            digits:true,
        },
        ownership_dob:{
            required: true,
            date: true,
            customDOBValidation: true
        },
        ownership_home_address:{
            maxlength:40,
            no_sql_keywords_and_special_chars: true
        },
        ownership_state:{
            maxlength:20,
            // no_sql_keywords_and_special_chars: true
        },
        ownership_city:{
            maxlength:20,
            no_sql_keywords_and_special_chars: true
        },
        ownership_zip:{
            zipcode:true,
            no_sql_keywords_and_special_chars: true
        },
        business_structure:{
            maxlength:20,
            no_sql_keywords_and_special_chars: true
        },
        num_employees:{
            maxlength:25,
            // no_sql_keywords_and_special_chars: true
        },
        sales_per_month:{
            maxlength:25,
            // no_sql_keywords_and_special_chars: true
        },
        bank_name:{
            maxlength:20,
            no_sql_keywords_and_special_chars: true
        },
        bank_account_manager_fn:{
            maxlength:20,
            no_sql_keywords_and_special_chars: true
        },
        bank_account_manager_ln:{
            maxlength:20,
            no_sql_keywords_and_special_chars: true
        },
        bank_account_manager_address:{
            maxlength:20,
            no_sql_keywords_and_special_chars: true
        },
        bank_account_manager_state:{
            maxlength:20,
            no_sql_keywords_and_special_chars: true
        },
        bank_account_manager_city:{
            maxlength:20,
            no_sql_keywords_and_special_chars: true

        },
        bank_account_manager_postal_code:{
            zipcode:true,
            no_sql_keywords_and_special_chars: true
        },
        bank_account_manager_telephone_number:{
            // maxlength:11,
            // no_sql_keywords_and_special_chars: true
        },
        bank_account_manager_email:{
            email:true,
            maxlength:35,
            noemail:true,
        },
        ein_number:{
            maxlength:9,
            no_sql_keywords_and_special_chars: true
        },
        primary_line_of_business:{
            maxlength:20,
            no_sql_keywords_and_special_chars: true
        },
        merchant_duns_number:{
            maxlength:9,
            no_sql_keywords_and_special_chars: true
        },
        pos_estimated_number:{
            maxlength:3,
            no_sql_keywords_and_special_chars: true
        },
        pos_manufacturer:{
            maxlength:50,
            no_sql_keywords_and_special_chars: true
        },
        when:{
            maxlength:20,
        },
        third_party_vendor:{
            maxlength:20,
            no_sql_keywords_and_special_chars: true
        },
        third_party_name:{
            maxlength:20,
            no_sql_keywords_and_special_chars: true
        },
        third_party_version:{
            maxlength:20,
        },
        third_party_name_transactions:{
            maxlength:20,
            no_sql_keywords_and_special_chars: true
        },
        qsa_name:{
            maxlength:20,
            no_sql_keywords_and_special_chars: true
        },
        compliance_date:{
            date:true,
        },
        last_scan_date:{
            date:true,
        },
        help_description:{
            maxlength:140,
            no_sql_keywords_and_special_chars: true
        },
        

    },
    messages: {
        business_legal_name: {
            no_sql_keywords_and_special_chars: "SQL keywords and special characters are not allowed"
        },
        business_dba_name: {
            no_sql_keywords_and_special_chars: "SQL keywords and special characters are not allowed"
        },
        business_legal_address: {
            no_sql_keywords_and_special_chars: "SQL keywords and special characters are not allowed"
        },
        third_party_vendor: {
            maxlength: "Third party vendor name cannot exceed 20 characters",
            no_sql_keywords_and_special_chars: "SQL keywords and special characters are not allowed in vendor name"
        },
        third_party_name: {
            maxlength: "Third party name cannot exceed 20 characters",
            no_sql_keywords_and_special_chars: "SQL keywords and special characters are not allowed in third party name"
        },
        third_party_version: {
            maxlength: "Version information cannot exceed 20 characters"
        },
        third_party_name_transactions: {
            maxlength: "Transaction name cannot exceed 20 characters",
            no_sql_keywords_and_special_chars: "SQL keywords and special characters are not allowed in transaction name"
        },
        qsa_name: {
            maxlength: "QSA name cannot exceed 20 characters",
            no_sql_keywords_and_special_chars: "SQL keywords and special characters are not allowed in QSA name"
        },
        help_description: {
            no_sql_keywords_and_special_chars: "SQL keywords and special characters are not allowed"
        },
        ownership_dob: {
            required: "Date of birth is required",
            date: "Please enter a valid date",
            customDOBValidation: "You must be at least 18 years old"
        },
        bank_name: {
            maxlength: "Bank name cannot exceed 20 characters",
            no_sql_keywords_and_special_chars: "SQL keywords and special characters are not allowed in bank name"
        },
        bank_account_manager_fn: {
            maxlength: "First name cannot exceed 20 characters",
            no_sql_keywords_and_special_chars: "SQL keywords and special characters are not allowed in first name"
        },
        bank_account_manager_ln: {
            maxlength: "Last name cannot exceed 20 characters",
            no_sql_keywords_and_special_chars: "SQL keywords and special characters are not allowed in last name"
        },
        bank_account_manager_address: {
            maxlength: "Address cannot exceed 20 characters",
            no_sql_keywords_and_special_chars: "SQL keywords and special characters are not allowed in address"
        },
        bank_account_manager_state: {
            maxlength: "State name cannot exceed 20 characters",
            no_sql_keywords_and_special_chars: "SQL keywords and special characters are not allowed in state name"
        },
        bank_account_manager_city: {
            maxlength: "City name cannot exceed 20 characters",
            no_sql_keywords_and_special_chars: "SQL keywords and special characters are not allowed in city name"
        },
        bank_account_manager_postal_code: {
            zipcode: "Please enter a valid 5-digit zip code",
            no_sql_keywords_and_special_chars: "SQL keywords and special characters are not allowed in postal code"
        },
        bank_account_manager_telephone_number: {
            no_sql_keywords_and_special_chars: "SQL keywords and special characters are not allowed in telephone number"
        },
        bank_account_manager_email: {
            email: "Please enter a valid email address",
            maxlength: "Email cannot exceed 35 characters",
            noemail: "Please enter a valid email address"
        },
        help_description:{
            maxlength: "Help description cannot exceed 140 characters",
            no_sql_keywords_and_special_chars: "SQL keywords and special characters are not allowed"
        }
    },

   
    
});

 function getinput()
{
    console.log('as')
    $("input").each(function() {
        if (!$(this).valid()) {

          console.log("Field not valid: " + $(this).attr("name"));
        }
      });
}

// legal business address
$("#business_legal_address").keyup(function(){
var searchInput = 'business_legal_address';
var autocomplete;
autocomplete = new google.maps.places.Autocomplete((document.getElementById(searchInput)), {
    types: ['geocode'],
    componentRestrictions: {country: 'US'} ,
});
var componentForm = {
    street_number: "short_name",
    route: "long_name",
    locality: "long_name",
    administrative_area_level_1: "short_name",
    country: 'long_name',
    postal_code: "short_name"
};
console.log('hell',autocomplete)
var city, state, country, postalCode, county, streetName, district,town,hamlet,urbanization_name;

google.maps.event.addListener(autocomplete, 'place_changed', function () {
    var place = autocomplete.getPlace();
    console.log(place)
 
    var geocoder = new google.maps.Geocoder();
    geocoder.geocode({'placeId': place.place_id}, function(results, status) {
      if (status === 'OK') {
        if (results[0]) {
          var addressComponents = results[0].address_components;
          for (var i = 0; i < addressComponents.length; i++) {
            if (addressComponents[i].types[0] == 'locality') {
              var city = addressComponents[i].long_name;
            }
            if (addressComponents[i].types[0] == 'administrative_area_level_1') {
              var state = addressComponents[i].long_name;
            }
            if (addressComponents[i].types[0] == 'country') {
              var country = addressComponents[i].long_name;
            }
            if (addressComponents[i].types[0] == 'postal_code') {
                var postcode = addressComponents[i].long_name;
              }
              if (addressComponents[i].types[0] == 'administrative_area_level_2') {
                var county = addressComponents[i].long_name;
              }
              if (addressComponents[i].types[0] == 'route') {
                var street = addressComponents[i].long_name;
              }
              if (addressComponents[i].types[0] == 'sublocality_level_1') {
                var district = addressComponents[i].long_name;
              }
              if (addressComponents[i].types[0] == 'administrative_area_level_3') {
                town = addressComponents[i].long_name;
              }
              if (addressComponents[i].types[0] == 'sublocality_level_3') {
                hamlet = addressComponents[i].long_name;
              }
              
          }
         
          $('#zip_legal').val(postcode);
          $('#state_legal').append($('<option>', {
            value: state,
            text: state,
            selected: true
        }));
        if(state !== undefined)
        {
            var state = $('#state').val();
            var cities = cities_by_state[state];
        
            // Clear the city select and add the default option
            $("#city_legal").empty().append('<option value="">Select a city</option>');
        
            // Populate the city select with options based on the selected state
            // $("#city").append("<option selected></option>");
            $.each(cities, function (index, city_) {
                $("#city_legal").append(`<option value="${city_}">` + city_ + "</option>");
            });
            
        $('#city_legal').append($('<option>', {
            value: city,
            text: city,
            selected: true
        }));
        }

        jQuery('#state_legal').parent().addClass("focus-input");

        jQuery('#city_legal').parent().addClass("focus-input");
        jQuery('#zip_legal').parent().addClass("focus-input");  
          
        //   console.log('urbanization_name '+urbanization_name,'hamlet '+hamlet,'town '+town,'city '+city, 'state '+state, 'country '+country,'county '+county,'street '+street,'district '+district);
        } else {
          alert('No results found');
        }
      } else {
        alert('Geocoder failed due to: ' + status);
      }
    });
    $("#latitude").val(place.geometry["location"].lat());
    $("#longitude").val(place.geometry["location"].lng());
    // document.getElementById('loc_lat').value = near_place.geometry.location.lat();
    // document.getElementById('loc_long').value = near_place.geometry.location.lng();
    
    // document.getElementById('latitude_view').innerHTML = near_place.geometry.location.lat();
    // document.getElementById('longitude_view').innerHTML = near_place.geometry.location.lng();
});
});
//



//physical address
$("#business_physical_address").keyup(function(){
var searchInput = 'business_physical_address';
var autocomplete;
autocomplete = new google.maps.places.Autocomplete((document.getElementById(searchInput)), {
    types: ['geocode'],
    componentRestrictions: {country: 'US'} ,
});
var componentForm = {
    street_number: "short_name",
    route: "long_name",
    locality: "long_name",
    administrative_area_level_1: "short_name",
    country: 'long_name',
    postal_code: "short_name"
};

var city, state, country, postalCode, county, streetName, district,town,hamlet,urbanization_name;

google.maps.event.addListener(autocomplete, 'place_changed', function () {
    var place = autocomplete.getPlace();
 
    var geocoder = new google.maps.Geocoder();
    geocoder.geocode({'placeId': place.place_id}, function(results, status) {
      if (status === 'OK') {
        if (results[0]) {
          var addressComponents = results[0].address_components;
          for (var i = 0; i < addressComponents.length; i++) {
            if (addressComponents[i].types[0] == 'locality') {
              var city = addressComponents[i].long_name;
            }
            if (addressComponents[i].types[0] == 'administrative_area_level_1') {
              var state = addressComponents[i].long_name;
            }
        
            if (addressComponents[i].types[0] == 'postal_code') {
                var postcode = addressComponents[i].long_name;
              }
           
              if (addressComponents[i].types[0] == 'administrative_area_level_3') {
                town = addressComponents[i].long_name;
              }
              if (addressComponents[i].types[0] == 'sublocality_level_3') {
                hamlet = addressComponents[i].long_name;
              }
              
          }
         
          $('#zip_physical').val(postcode);
          $('#state_physical').append($('<option>', {
            value: state,
            text: state,
            selected: true
        }));
        if(state !== undefined)
        {
            var state = $('#state_physical').val();
            var cities = cities_by_state[state];
        
            // Clear the city select and add the default option
            $("#city_physical").empty().append('<option value="">Select a city</option>');
        
            // Populate the city select with options based on the selected state
            // $("#city").append("<option selected></option>");
            $.each(cities, function (index, city_) {
                $("#city_physical").append(`<option value="${city_}">` + city_ + "</option>");
            });
            
        $('#city_physical').append($('<option>', {
            value: city,
            text: city,
            selected: true
        }));
        }

        jQuery('#state_physical').parent().addClass("focus-input");

        jQuery('#city_physical').parent().addClass("focus-input");
        jQuery('#zip_physical').parent().addClass("focus-input");  
          
        //   console.log('urbanization_name '+urbanization_name,'hamlet '+hamlet,'town '+town,'city '+city, 'state '+state, 'country '+country,'county '+county,'street '+street,'district '+district);
        } else {
          alert('No results found');
        }
      } else {
        alert('Geocoder failed due to: ' + status);
      }
    });

   
});
});
///



//home address
$("#ownership_home_address").keyup(function(){
var searchInput = 'ownership_home_address';
var autocomplete;
autocomplete = new google.maps.places.Autocomplete((document.getElementById(searchInput)), {
    types: ['geocode'],
    componentRestrictions: {country: 'US'} ,
});
var componentForm = {
    street_number: "short_name",
    route: "long_name",
    locality: "long_name",
    administrative_area_level_1: "short_name",
    country: 'long_name',
    postal_code: "short_name"
};

var city, state, country, postalCode, county, streetName, district,town,hamlet,urbanization_name;

google.maps.event.addListener(autocomplete, 'place_changed', function () {
    var place = autocomplete.getPlace();
 
    var geocoder = new google.maps.Geocoder();
    geocoder.geocode({'placeId': place.place_id}, function(results, status) {
      if (status === 'OK') {
        if (results[0]) {
          var addressComponents = results[0].address_components;
          for (var i = 0; i < addressComponents.length; i++) {
            if (addressComponents[i].types[0] == 'locality') {
              var city = addressComponents[i].long_name;
            }
            if (addressComponents[i].types[0] == 'administrative_area_level_1') {
              var state = addressComponents[i].long_name;
            }
        
            if (addressComponents[i].types[0] == 'postal_code') {
                var postcode = addressComponents[i].long_name;
              }
           
              if (addressComponents[i].types[0] == 'administrative_area_level_3') {
                town = addressComponents[i].long_name;
              }
              if (addressComponents[i].types[0] == 'sublocality_level_3') {
                hamlet = addressComponents[i].long_name;
              }
              
          }
         
          $('#ownership_zip').val(postcode);
          $('#ownership_state').append($('<option>', {
            value: state,
            text: state,
            selected: true
        }));
        if(state !== undefined)
        {
            var state = $('#ownership_state').val();
            var cities = cities_by_state[state];
        
            // Clear the city select and add the default option
            $("#ownership_city").empty().append('<option value="">Select a city</option>');
        
            // Populate the city select with options based on the selected state
            // $("#city").append("<option selected></option>");
            $.each(cities, function (index, city_) {
                $("#ownership_city").append(`<option value="${city_}">` + city_ + "</option>");
            });
            
        $('#ownership_city').append($('<option>', {
            value: city,
            text: city,
            selected: true
        }));
        }

        jQuery('#ownership_state').parent().addClass("focus-input");

        jQuery('#ownership_city').parent().addClass("focus-input");
        jQuery('#ownership_zip').parent().addClass("focus-input");  
          
        //   console.log('urbanization_name '+urbanization_name,'hamlet '+hamlet,'town '+town,'city '+city, 'state '+state, 'country '+country,'county '+county,'street '+street,'district '+district);
        } else {
          alert('No results found');
        }
      } else {
        alert('Geocoder failed due to: ' + status);
      }
    });

   
});
});
//



//account manager address
$("#bank_account_manager_address").keyup(function(){
  
var searchInput = 'bank_account_manager_address';
var autocomplete;
autocomplete = new google.maps.places.Autocomplete((document.getElementById(searchInput)), {
    types: ['geocode'],
    componentRestrictions: {country: 'US'} ,
});
var componentForm = {
    street_number: "short_name",
    route: "long_name",
    locality: "long_name",
    administrative_area_level_1: "short_name",
    country: 'long_name',
    postal_code: "short_name"
};

var city, state, country, postalCode, county, streetName, district,town,hamlet,urbanization_name;

google.maps.event.addListener(autocomplete, 'place_changed', function () {
    var place = autocomplete.getPlace();
 
    var geocoder = new google.maps.Geocoder();
    geocoder.geocode({'placeId': place.place_id}, function(results, status) {
      if (status === 'OK') {
        if (results[0]) {
          var addressComponents = results[0].address_components;
          for (var i = 0; i < addressComponents.length; i++) {
            if (addressComponents[i].types[0] == 'locality') {
              var city = addressComponents[i].long_name;
            }
            if (addressComponents[i].types[0] == 'administrative_area_level_1') {
              var state = addressComponents[i].long_name;
            }
        
            if (addressComponents[i].types[0] == 'postal_code') {
                var postcode = addressComponents[i].long_name;
              }
           
              if (addressComponents[i].types[0] == 'administrative_area_level_3') {
                town = addressComponents[i].long_name;
              }
              if (addressComponents[i].types[0] == 'sublocality_level_3') {
                hamlet = addressComponents[i].long_name;
              }
              
          }
         
          $('#bank_account_manager_zipcode').val(postcode);
          $('#bank_account_manager_state').append($('<option>', {
            value: state,
            text: state,
            selected: true
        }));
        if(state !== undefined)
        {
            var state = $('#bank_account_manager_state').val();
            var cities = cities_by_state[state];
        
            // Clear the city select and add the default option
            $("#bank_account_manager_city").empty().append('<option value="">Select a city</option>');
        
            // Populate the city select with options based on the selected state
            // $("#city").append("<option selected></option>");
            $.each(cities, function (index, city_) {
                $("#bank_account_manager_city").append(`<option value="${city_}">` + city_ + "</option>");
            });
            
        $('#bank_account_manager_city').append($('<option>', {
            value: city,
            text: city,
            selected: true
        }));
        }

        jQuery('#bank_account_manager_state').parent().addClass("focus-input");

        jQuery('#bank_account_manager_city').parent().addClass("focus-input");
        jQuery('#bank_account_manager_zipcode').parent().addClass("focus-input");  
          
        //   console.log('urbanization_name '+urbanization_name,'hamlet '+hamlet,'town '+town,'city '+city, 'state '+state, 'country '+country,'county '+county,'street '+street,'district '+district);
        } else {
          alert('No results found');
        }
      } else {
        alert('Geocoder failed due to: ' + status);
      }
    });

   
});
});
//

// Add real-time input cleaning for text fields
$('input[type="text"], textarea').on('input', function() {
    $(this).valid(); // Trigger validation on input
});

// Prevent paste of SQL keywords
$('input[type="text"], textarea').on('paste', function(e) {
    setTimeout(() => {
        $(this).valid(); // Validate after paste
    }, 0);
});

// Add real-time validation for all text inputs
$('input[type="text"], textarea').on('input', function() {
    const input = $(this);
    const value = input.val();
    const forbiddenKeywords = [
        "SELECT", "INSERT", "UPDATE", "DELETE", "DROP", "UNION", "JOIN", 
        "WHERE", "FROM", "ALTER", "CREATE", "TABLE", "DATABASE", "TRUNCATE", 
        "EXEC", "HAVING", "GROUP BY", "ORDER BY", "MERGE", "GRANT", "REVOKE",
        "PROCEDURE", "FUNCTION", "TRIGGER", "INDEX", "VIEW", "SCHEMA", "INTO",
        "VALUES", "SET", "PUT", "DECLARE", "EXECUTE", "SP_", "XP_", "--", ";--", ";",
        "WAITFOR", "DELAY", "SHUTDOWN", "BACKUP", "RESTORE", "PRINT", "/*", "*/",
        "AND", "OR", "NOT", "NULL", "INTRO", "COUNT", "SUM", "AVG", "LIKE", "WILDCARD"
    ];

    const upperValue = value.toUpperCase();
    let containsSQLKeyword = false;
    
    for (let keyword of forbiddenKeywords) {
        if (upperValue.includes(keyword)) {
            containsSQLKeyword = true;
            toastr.error(`SQL keyword "${keyword}" is not allowed`);
            input.addClass('error');
            break;
        }
    }

    // Check for special characters
    const specialChars = /[!@#$%^&*()_+={}:"<>]/;
    if (specialChars.test(value)) {
        toastr.error('Special characters are not allowed');
        input.addClass('error');
    }

    if (!containsSQLKeyword && !specialChars.test(value)) {
        input.removeClass('error');
    }
});

// Prevent form submission if there are SQL keywords
$("#update_my_info_form").on('submit', function(e) {
    const form = $(this);
    if (!form.valid()) {
        e.preventDefault();
        toastr.error('Please remove SQL keywords and special characters before submitting');
        return false;
    }
});

// Phone number validation function
function validatePhoneNumber(phoneNumber, countryCode = 'US') {
    try {
        // Remove any non-digit characters
        const cleanNumber = phoneNumber.replace(/\D/g, '');
        
        // For US numbers, ensure it's not a fake number
        if (countryCode === 'US') {
            if (cleanNumber.match(/^555/) || // 555 prefix
                cleanNumber.match(/^0{3}/) || // 000 prefix
                cleanNumber.match(/(\d)\1{9}/) || // Same digit repeated
                cleanNumber === '1234567890' || // Sequential numbers
                cleanNumber === '0987654321') { // Reverse sequential
                return {
                    isValid: false,
                    message: 'Invalid phone number pattern'
                };
            }
        }

        // Check length
        if (cleanNumber.length !== 10) {
            return {
                isValid: false,
                message: 'Phone number must be 10 digits'
            };
        }

        // Format the number
        const areaCode = cleanNumber.substring(0, 3);
        const firstPart = cleanNumber.substring(3, 6);
        const secondPart = cleanNumber.substring(6, 10);
        const formattedNumber = `(${areaCode}) ${firstPart}-${secondPart}`;

        return {
            isValid: true,
            formattedNumber: formattedNumber,
            areaCode: areaCode,
            mainNumber: `${firstPart}${secondPart}`
        };
    } catch (error) {
        return {
            isValid: false,
            message: 'Invalid phone number'
        };
    }
}

// Initialize phone input fields
function initPhoneInputs() {
    const phoneInputs = [
        'telephone_number',
        'toll_free_number',
        'fax_number',
        'mobile_phone',
        'ownership_telephone'
    ];

    phoneInputs.forEach(inputId => {
        const input = document.getElementById(inputId);
        if (!input) return;

        // Input event handler
        input.addEventListener('input', function() {
            const result = validatePhoneNumber(this.value);
            const errorElement = this.closest('.form-group').querySelector('.text_danger');
            
            if (result.isValid) {
                this.value = result.formattedNumber;
                this.classList.add('valid');
                this.classList.remove('invalid');
                errorElement.textContent = '';
                this.setCustomValidity('');
            } else {
                this.classList.remove('valid');
                this.classList.add('invalid');
                errorElement.textContent = result.message;
                this.setCustomValidity(result.message);
            }
        });

        // Keypress event to allow only numbers
        input.addEventListener('keypress', function(e) {
            const key = e.which || e.keyCode;
            if (key < 48 || key > 57) {
                e.preventDefault();
            }
        });

        // Paste event handler
        input.addEventListener('paste', function(e) {
            e.preventDefault();
            const pastedText = (e.originalEvent.clipboardData || window.clipboardData).getData('text');
            const cleanNumber = pastedText.replace(/\D/g, '');
            const result = validatePhoneNumber(cleanNumber);
            
            if (result.isValid) {
                this.value = result.formattedNumber;
                this.classList.add('valid');
                this.classList.remove('invalid');
                this.closest('.form-group').querySelector('.text_danger').textContent = '';
                this.setCustomValidity('');
            }
        });

        // Blur event for final formatting
        input.addEventListener('blur', function() {
            if (this.value) {
                const result = validatePhoneNumber(this.value);
                if (result.isValid) {
                    this.value = result.formattedNumber;
                }
            }
        });
    });
}

// Initialize split phone inputs (area code + main number)
function initSplitPhoneInputs() {
    const splitPhonePairs = [
        { areaCode: 'area_code', mainNumber: 'phone_number' }
        // Add other split phone input pairs here if needed
    ];

    splitPhonePairs.forEach(pair => {
        const areaCodeInput = document.getElementById(pair.areaCode);
        const mainNumberInput = document.getElementById(pair.mainNumber);
        
        if (!areaCodeInput || !mainNumberInput) return;

        // Area code input handler
        areaCodeInput.addEventListener('input', function() {
            this.value = this.value.replace(/\D/g, '').substring(0, 3);
            validateSplitPhone(pair.areaCode, pair.mainNumber);
        });

        // Main number input handler
        mainNumberInput.addEventListener('input', function() {
            let cleaned = this.value.replace(/\D/g, '');
            if (cleaned.length > 7) cleaned = cleaned.substring(0, 7);
            
            if (cleaned.length > 3) {
                this.value = cleaned.substring(0, 3) + '-' + cleaned.substring(3);
            } else {
                this.value = cleaned;
            }
            validateSplitPhone(pair.areaCode, pair.mainNumber);
        });
    });
}

// Validate split phone inputs
function validateSplitPhone(areaCodeId, mainNumberId) {
    const areaCodeInput = document.getElementById(areaCodeId);
    const mainNumberInput = document.getElementById(mainNumberId);
    
    const areaCode = areaCodeInput.value;
    const mainNumber = mainNumberInput.value.replace(/\D/g, '');
    
    if (areaCode || mainNumber) {
        const fullNumber = areaCode + mainNumber;
        const result = validatePhoneNumber(fullNumber);
        
        const areaCodeError = areaCodeInput.closest('.form-group').querySelector('.text_danger');
        const mainNumberError = mainNumberInput.closest('.form-group').querySelector('.text_danger');
        
        if (result.isValid) {
            areaCodeError.textContent = '';
            mainNumberError.textContent = '';
            areaCodeInput.setCustomValidity('');
            mainNumberInput.setCustomValidity('');
        } else {
            if (!areaCode || areaCode.length !== 3) {
                areaCodeError.textContent = 'Please enter a valid 3-digit area code';
                areaCodeInput.setCustomValidity('Invalid area code');
            }
            
            if (!mainNumber || mainNumber.length !== 7) {
                mainNumberError.textContent = 'Please enter a valid 7-digit phone number';
                mainNumberInput.setCustomValidity('Invalid phone number');
            }
        }
    }
}

// Initialize on document ready
$(document).ready(function() {
    initPhoneInputs();
    initSplitPhoneInputs();
});

// Add SSN validation function
function validateSSN(value) {
    // Remove any non-digit characters
    const cleanSSN = value.replace(/\D/g, '');
    
    // Check for invalid patterns
    if (
        cleanSSN === '000000000' ||
        cleanSSN === '111111111' ||
        cleanSSN === '222222222' ||
        cleanSSN === '333333333' ||
        cleanSSN === '444444444' ||
        cleanSSN === '555555555' ||
        cleanSSN === '666666666' ||
        cleanSSN === '777777777' ||
        cleanSSN === '888888888' ||
        cleanSSN === '999999999' ||
        cleanSSN === '123456789' ||
        cleanSSN === '987654321' ||
        cleanSSN.substring(0, 3) === '000' ||
        cleanSSN.substring(0, 3) === '666' ||
        cleanSSN.substring(0, 3) === '900' ||
        cleanSSN.substring(3, 5) === '00' ||
        cleanSSN.substring(5, 9) === '0000'
    ) {
        return {
            isValid: false,
            message: 'Invalid SSN pattern'
        };
    }

    // Check length
    if (cleanSSN.length !== 9) {
        return {
            isValid: false,
            message: 'SSN must be 9 digits'
        };
    }

    // Format SSN as XXX-XX-XXXX
    const formattedSSN = `${cleanSSN.substring(0, 3)}-${cleanSSN.substring(3, 5)}-${cleanSSN.substring(5, 9)}`;

    return {
        isValid: true,
        formattedValue: formattedSSN
    };
}

// Initialize SSN input fields
function initSSNInputs() {
    const ssnInputs = [
        'ownership_ssn',
        // Add any other SSN input fields here
    ];

    ssnInputs.forEach(inputId => {
        const input = document.getElementById(inputId);
        if (!input) return;

        // Input event handler
        input.addEventListener('input', function() {
            const result = validateSSN(this.value);
            const errorElement = this.closest('.form-group').querySelector('.text_danger');
            
            if (result.isValid) {
                this.value = result.formattedValue;
                this.classList.add('valid');
                this.classList.remove('invalid');
                errorElement.textContent = '';
                this.setCustomValidity('');
            } else {
                this.classList.remove('valid');
                this.classList.add('invalid');
                errorElement.textContent = result.message;
                this.setCustomValidity(result.message);
            }
        });

        // Keypress event to allow only numbers
        input.addEventListener('keypress', function(e) {
            const key = e.which || e.keyCode;
            if (key < 48 || key > 57) {
                e.preventDefault();
            }
        });

        // Paste event handler
        input.addEventListener('paste', function(e) {
            e.preventDefault();
            const pastedText = (e.originalEvent.clipboardData || window.clipboardData).getData('text');
            const cleanNumber = pastedText.replace(/\D/g, '');
            const result = validateSSN(cleanNumber);
            
            if (result.isValid) {
                this.value = result.formattedValue;
                this.classList.add('valid');
                this.classList.remove('invalid');
                this.closest('.form-group').querySelector('.text_danger').textContent = '';
                this.setCustomValidity('');
            }
        });

        // Blur event for final formatting
        input.addEventListener('blur', function() {
            if (this.value) {
                const result = validateSSN(this.value);
                if (result.isValid) {
                    this.value = result.formattedValue;
                }
            }
        });
    });
}

// Initialize on document ready
$(document).ready(function() {
    // ... existing initializations ...
    initSSNInputs();
});

// Date of birth validation function
function validateDOB() {
    const dobInput = document.getElementById('ownership_dob');
    if (!dobInput) return;

    // Calculate minimum allowed date (18 years ago)
    const today = new Date();
    const minDate = new Date(
        today.getFullYear() - 18,
        today.getMonth(),
        today.getDate()
    );

    // Set max attribute to minimum allowed date
    dobInput.max = minDate.toISOString().split('T')[0];

    // Add validation handler
    dobInput.addEventListener('input', function() {
        const selectedDate = new Date(this.value);
        const errorElement = this.closest('.form-group').querySelector('.text_danger');

        if (selectedDate > minDate) {
            this.classList.remove('valid');
            this.classList.add('invalid');
            errorElement.textContent = 'You must be at least 18 years old';
            this.setCustomValidity('You must be at least 18 years old');
        } else {
            this.classList.add('valid');
            this.classList.remove('invalid');
            errorElement.textContent = '';
            this.setCustomValidity('');
        }
    });

    // Add blur handler for additional validation
    dobInput.addEventListener('blur', function() {
        if (!this.value) {
            const errorElement = this.closest('.form-group').querySelector('.text_danger');
            this.classList.remove('valid');
            this.classList.add('invalid');
            errorElement.textContent = 'Date of birth is required';
            this.setCustomValidity('Date of birth is required');
        }
    });
}

// Add custom validation method for DOB
$.validator.addMethod(
    "customDOBValidation",
    function(value, element) {
        if (!value) return false;
        
        const selectedDate = new Date(value);
        const today = new Date();
        const minDate = new Date(
            today.getFullYear() - 18,
            today.getMonth(),
            today.getDate()
        );
        
        return selectedDate <= minDate;
    },
    "You must be at least 18 years old"
);

// Initialize on document ready
$(document).ready(function() {
    // ... existing initializations ...
    validateDOB();
});